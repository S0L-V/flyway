<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.flyway.admin.mapper.AdminDashboardMapper">

    <!-- 통계 조회 쿼리 -->
    <!-- 일일 방문자 수 (visitor_log 테이블에서 유니크 세션 기준 -->
    <select id="countDailyVisitors" resultType="long">
        SELECT COUNT(DISTINCT session_id)
        FROM visitor_log
        WHERE DATE(visited_at) = CURDATE()
    </select>

    <!-- 일일 예약 건수 -->
    <select id="countDailyReservations" resultType="long">
        SELECT COUNT(*)
        FROM reservation
        WHERE DATE(created_at) = CURDATE()
    </select>

    <!-- 일일 결제 완료 건수 -->
    <select id="countDailyPayments" resultType="long">
        SELECT COUNT(*)
        FROM payment
        WHERE DATE(paid_at) = CURDATE()
            AND status = 'COMPLETED'
    </select>

</mapper>